<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Features &mdash; TwitterServer 1.18.0 documentation</title>
    
    <link rel="stylesheet" href="_static/flasky.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.18.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="TwitterServer 1.18.0 documentation" href="index.html" />
    <link rel="next" title="Using TwitterServer from Java" href="Java.html" />
    <link rel="prev" title="TwitterServer" href="index.html" />
   
  
  <link media="only screen and (max-device-width: 480px)" href="_static/small_flask.css" type= "text/css" rel="stylesheet" />

  </head>
  <body>
  
  

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="Java.html" title="Using TwitterServer from Java"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="TwitterServer"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">TwitterServer</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="features">
<h1>Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h1>
<p>We’ll walk through the features provided by TwitterServer by
examining a slightly more advanced version of the example shown in the
introduction.</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">import</span> <span class="nn">com.twitter.conversions.time._</span>
<span class="k">import</span> <span class="nn">com.twitter.finagle.http.</span><span class="o">{</span><span class="nc">HttpMuxer</span><span class="o">,</span> <span class="nc">Request</span><span class="o">,</span> <span class="nc">Response</span><span class="o">,</span> <span class="nc">Status</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">com.twitter.finagle.Service</span>
<span class="k">import</span> <span class="nn">com.twitter.io.Charsets</span>
<span class="k">import</span> <span class="nn">com.twitter.logging.Formatter</span>
<span class="k">import</span> <span class="nn">com.twitter.server.TwitterServer</span>
<span class="k">import</span> <span class="nn">com.twitter.util.</span><span class="o">{</span><span class="nc">Await</span><span class="o">,</span> <span class="nc">Future</span><span class="o">,</span> <span class="nc">Time</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">java.net.InetSocketAddress</span>

<span class="k">object</span> <span class="nc">AdvancedServer</span> <span class="k">extends</span> <span class="nc">TwitterServer</span> <span class="o">{</span>

  <span class="k">val</span> <span class="n">what</span> <span class="k">=</span> <span class="n">flag</span><span class="o">(</span><span class="s">&quot;what&quot;</span><span class="o">,</span> <span class="s">&quot;hello&quot;</span><span class="o">,</span> <span class="s">&quot;String to return&quot;</span><span class="o">)</span>
  <span class="k">val</span> <span class="n">addr</span> <span class="k">=</span> <span class="n">flag</span><span class="o">(</span><span class="s">&quot;bind&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="nc">InetSocketAddress</span><span class="o">(</span><span class="mi">0</span><span class="o">),</span> <span class="s">&quot;Bind address&quot;</span><span class="o">)</span>
  <span class="k">val</span> <span class="n">durations</span> <span class="k">=</span> <span class="n">flag</span><span class="o">(</span><span class="s">&quot;alarms&quot;</span><span class="o">,</span> <span class="o">(</span><span class="mf">1.</span><span class="n">second</span><span class="o">,</span> <span class="mf">5.</span><span class="n">second</span><span class="o">),</span> <span class="s">&quot;2 alarm durations&quot;</span><span class="o">)</span>
  <span class="k">val</span> <span class="n">counter</span> <span class="k">=</span> <span class="n">statsReceiver</span><span class="o">.</span><span class="n">counter</span><span class="o">(</span><span class="s">&quot;requests_counter&quot;</span><span class="o">)</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">defaultFormatter</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Formatter</span><span class="o">(</span>
    <span class="n">timezone</span> <span class="k">=</span> <span class="nc">Some</span><span class="o">(</span><span class="s">&quot;UTC&quot;</span><span class="o">),</span>
    <span class="n">prefix</span> <span class="k">=</span> <span class="s">&quot;&lt;yyyy-MM-dd HH:mm:ss.SSS&gt; [%.3s] %s: &quot;</span>
  <span class="o">)</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">failfastOnFlagsNotParsed</span><span class="k">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="kc">true</span>

  <span class="k">val</span> <span class="n">service</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Service</span><span class="o">[</span><span class="kt">Request</span>, <span class="kt">Response</span><span class="o">]</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">apply</span><span class="o">(</span><span class="n">request</span><span class="k">:</span> <span class="kt">Request</span><span class="o">)</span> <span class="k">=</span> <span class="o">{</span>
      <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="o">(</span><span class="s">&quot;Received a request at &quot;</span> <span class="o">+</span> <span class="nc">Time</span><span class="o">.</span><span class="n">now</span><span class="o">)</span>
      <span class="n">counter</span><span class="o">.</span><span class="n">incr</span><span class="o">()</span>
      <span class="k">val</span> <span class="n">response</span> <span class="k">=</span> <span class="nc">Response</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="n">version</span><span class="o">,</span> <span class="nc">Status</span><span class="o">.</span><span class="nc">Ok</span><span class="o">)</span>
      <span class="n">response</span><span class="o">.</span><span class="n">contentString</span> <span class="k">=</span> <span class="n">what</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot;\n&quot;</span>
      <span class="nc">Future</span><span class="o">.</span><span class="n">value</span><span class="o">(</span><span class="n">response</span><span class="o">)</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="k">def</span> <span class="n">main</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// We can create a new http server but in that case we profit from the</span>
    <span class="c1">// one already started for /admin/*</span>
    <span class="c1">// The `TwitterServer` trait exposes an `adminHttpServer` that serve all routes</span>
    <span class="c1">// registered in the HttpMuxer object, we just have to add our own.</span>
    <span class="nc">HttpMuxer</span><span class="o">.</span><span class="n">addHandler</span><span class="o">(</span><span class="s">&quot;/echo&quot;</span><span class="o">,</span> <span class="n">service</span><span class="o">)</span>
    <span class="nc">HttpMuxer</span><span class="o">.</span><span class="n">addHandler</span><span class="o">(</span><span class="s">&quot;/echo/&quot;</span><span class="o">,</span> <span class="n">service</span><span class="o">)</span>
    <span class="c1">// And wait on the server</span>
    <span class="nc">Await</span><span class="o">.</span><span class="n">ready</span><span class="o">(</span><span class="n">adminHttpServer</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="section" id="flags">
<h2>Flags<a class="headerlink" href="#flags" title="Permalink to this headline">¶</a></h2>
<p>The flags implementation, <a class="reference external" href="https://github.com/twitter/util/blob/master/util-app/src/main/scala/com/twitter/app/Flag.scala">found in Twitter&#8217;s util library</a>,
focuses on simplicity and type safety, parsing flags into Scala values.</p>
<p>You define your flag like this, in that case the flag type is <cite>String</cite>:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">val</span> <span class="n">what</span> <span class="k">=</span> <span class="n">flag</span><span class="o">(</span><span class="s">&quot;what&quot;</span><span class="o">,</span> <span class="s">&quot;hello&quot;</span><span class="o">,</span> <span class="s">&quot;String to return&quot;</span><span class="o">)</span>
</pre></div>
</div>
<p>But you can also define flags of composite type:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">val</span> <span class="n">addr</span> <span class="k">=</span> <span class="n">flag</span><span class="o">(</span><span class="s">&quot;bind&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="nc">InetSocketAddress</span><span class="o">(</span><span class="mi">0</span><span class="o">),</span> <span class="s">&quot;Bind address&quot;</span><span class="o">)</span>
<span class="k">val</span> <span class="n">durations</span> <span class="k">=</span> <span class="n">flag</span><span class="o">(</span><span class="s">&quot;alarms&quot;</span><span class="o">,</span> <span class="o">(</span><span class="mf">1.</span><span class="n">second</span><span class="o">,</span> <span class="mf">5.</span><span class="n">second</span><span class="o">),</span> <span class="s">&quot;2 alarm durations&quot;</span><span class="o">)</span>
</pre></div>
</div>
<p>We also provide an automatic help entry that displays information about
all the flags defined.</p>
<div class="highlight-text"><div class="highlight"><pre>$ java -jar target/myserver-1.0.0-SNAPSHOT.jar -help
AdvancedServer
  -alarm_durations=&#39;1.seconds,5.seconds&#39;: 2 alarm durations
  -help=&#39;false&#39;: Show this help
  -admin.port=&#39;:9990&#39;: Admin http server port
  -bind=&#39;:0&#39;: Network interface to use
  -log.level=&#39;INFO&#39;: Log level
  -log.output=&#39;/dev/stderr&#39;: Output file
  -what=&#39;hello&#39;: String to return
</pre></div>
</div>
<p>Note that you cannot read flags until after the arguments have been
parsed, which happens before premains have been executed, but after
the constructor and the inits.  Similarly, you should only declare a
flag in the constructor, before the arguments have been parsed.</p>
<p>As a precaution, we recommend turning on the <cite>failfastOnFlagsNotParsed</cite>
option within your server. Having this option turned on means that if
a <cite>Flag</cite> is attempted to be accessed before the flag has been parsed,
then an <cite>IllegalStateException</cite> will be thrown.</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">override</span> <span class="k">def</span> <span class="n">failfastOnFlagsNotParsed</span><span class="k">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="kc">true</span>
</pre></div>
</div>
</div>
<div class="section" id="logging">
<h2>Logging<a class="headerlink" href="#logging" title="Permalink to this headline">¶</a></h2>
<p>The <cite>TwitterServer</cite> trait provides a logger named <cite>log</cite>. It is
configured via default command line flags: <cite>-log.level</cite> and
<cite>-log.output</cite>. As you can see from the above <cite>-help</cite> output, it logs
to <cite>stderr</cite> by default with a log level of <cite>INFO</cite>.</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="o">(</span><span class="s">&quot;Received a request at &quot;</span> <span class="o">+</span> <span class="nc">Time</span><span class="o">.</span><span class="n">now</span><span class="o">)</span>
</pre></div>
</div>
<p>To change the format of the log output, a custom <cite>Formatter</cite> is needed.
This is best done by overriding the <cite>defaultFormatter</cite> provided by the
<cite>Logging</cite> trait.</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">override</span> <span class="k">def</span> <span class="n">defaultFormatter</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Formatter</span><span class="o">(</span>
  <span class="n">timezone</span> <span class="k">=</span> <span class="nc">Some</span><span class="o">(</span><span class="s">&quot;UTC&quot;</span><span class="o">),</span>
  <span class="n">prefix</span> <span class="k">=</span> <span class="s">&quot;&lt;yyyy-MM-dd HH:mm:ss.SSS&gt; [%.3s] %s: &quot;</span>
<span class="o">)</span>
</pre></div>
</div>
<p>For more complicated logging schemes, you can extend the Logging trait
and mix it back into a <cite>TwitterServer</cite>.</p>
<p>Per-logger log levels can be changed on-the-fly via the logging
handler on the admin interface.</p>
</div>
<div class="section" id="metrics">
<span id="metrics-label"></span><h2>Metrics<a class="headerlink" href="#metrics" title="Permalink to this headline">¶</a></h2>
<p>Note: In order to enable usage of the Metrics library, you must have
the finagle-stats jar on your classpath.  <cite>finagle-stats</cite> depends on
libraries which can be found in the
<a class="reference external" href="https://maven.twttr.com">https://maven.twttr.com</a> repository.  There
are instructions on the <a class="reference internal" href="index.html"><em>quickstart</em></a> for adding it in
maven or sbt.</p>
<p>The <cite>statsReceiver</cite> field of <cite>TwitterServer</cite> defines a sink for
metrics. With it you can update counters and stats (histograms) or
define gauges (instantaneous values).</p>
<p>For instance, you define your stats:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">val</span> <span class="n">counter</span> <span class="k">=</span> <span class="n">statsReceiver</span><span class="o">.</span><span class="n">counter</span><span class="o">(</span><span class="s">&quot;requests_counter&quot;</span><span class="o">)</span>
</pre></div>
</div>
<p>And update the value:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="n">counter</span><span class="o">.</span><span class="n">incr</span><span class="o">()</span>
</pre></div>
</div>
<p>The value of this counter will be exported by the HTTP server and
accessible at /admin/metrics.json. To see an example of the counter
incrementing run the following:</p>
<div class="highlight-text"><div class="highlight"><pre>$ curl -s localhost:9990/admin/metrics.json | jq &#39;.requests_counter&#39;
0

$ curl -s localhost:9990/echo
hello

$ curl -s localhost:9990/admin/metrics.json | jq &#39;.requests_counter&#39;
1
</pre></div>
</div>
<div class="section" id="filtering-stats-out">
<h3>Filtering stats out<a class="headerlink" href="#filtering-stats-out" title="Permalink to this headline">¶</a></h3>
<p>Metrics can be too expensive to store. By passing a comma-separated
list of regexes to exclude from stats using
<cite>-com.twitter.finagle.stats.statsFilter</cite> flag, one can single out the
stats that will not be shown when queried with <cite>filtered=true</cite>. In
other words, you can still access all of the stats normally, but this
adds the option to fetch the filtered list.</p>
<p>For example, to filter out all stats starting with jvm and also any
p90 stats, one can pass the following to TwitterServer:</p>
<div class="highlight-text"><div class="highlight"><pre>-com.twitter.finagle.stats.statsFilter=&quot;jvm.*,.*\.p90&quot;
</pre></div>
</div>
<p>To query the reduced list:</p>
<div class="highlight-text"><div class="highlight"><pre>/admin/metrics.json?filtered=true
</pre></div>
</div>
<p>Note that this only works with <cite>finagle-stats</cite> and doesn&#8217;t work with
<cite>finagle-ostrich4</cite>.</p>
</div>
<div class="section" id="pretty-output">
<h3>Pretty output<a class="headerlink" href="#pretty-output" title="Permalink to this headline">¶</a></h3>
<p>If you would like a pretty version of the json output, add the
parameter pretty=true or pretty=1, eg /admin/metrics.json?pretty=true</p>
<div class="highlight-text"><div class="highlight"><pre>{
  &quot;requests_counter&quot;: 234,
  &quot;finagle/closechans&quot;: 592,
  &quot;finagle/closed&quot;: 592,
  &quot;finagle/closes&quot;: 575,
  &quot;finagle/connection_duration.avg&quot;: 561,
  &quot;finagle/connection_duration.count&quot;: 592,
  &quot;finagle/connection_duration.max&quot;: 299986,
  &quot;finagle/connection_duration.min&quot;: 3,
  &quot;finagle/connection_duration.p25&quot;: 29,
  &quot;finagle/connection_duration.p50&quot;: 31,
  &quot;finagle/connection_duration.p75&quot;: 58,
  &quot;finagle/connection_duration.p90&quot;: 111,
  &quot;finagle/connection_duration.p95&quot;: 120,
  &quot;finagle/connection_duration.p99&quot;: 197,
  &quot;finagle/connection_duration.p9990&quot;: 2038,
  &quot;finagle/connection_duration.p9999&quot;: 2038,
  &quot;finagle/connection_duration.sum&quot;: 332690,
  &quot;finagle/connections&quot;: 2,
  &quot;finagle/http/failfast/unhealthy_for_ms&quot;: 0,
  &quot;finagle/http/failfast/unhealthy_num_tries&quot;: 0,
  &quot;finagle/success&quot;: 0
  ...
}
</pre></div>
</div>
</div>
</div>
<div class="section" id="http-admin-interface">
<h2>HTTP Admin interface<a class="headerlink" href="#http-admin-interface" title="Permalink to this headline">¶</a></h2>
<p>TwitterServer starts an HTTP server (it binds to the port defined by
the flag <cite>-admin.port</cite>; port 9990 by default). It exports an <cite>HttpMuxer</cite>
object in which endpoints are registered.  The library defines a
series of default endpoints:</p>
<dl class="docutils">
<dt><strong>/admin/announcer</strong></dt>
<dd>Returns a set of announcement chains that have run through the
Announcer. This allows one to see how a particular target is being
announced.</dd>
<dt><strong>/admin/pprof/contention</strong></dt>
<dd>Returns a CPU contention profile which identifies blocked threads
(<cite>Thread.State.BLOCKED</cite>).
The output is in <a class="reference external" href="https://github.com/gperftools/gperftools">pprof</a> format.
The process will be profiled for 10 seconds at a frequency of 100 hz. These
values can be controlled via HTTP request parameters <cite>seconds</cite> and <cite>hz</cite>
respectively.</dd>
<dt><strong>/admin/pprof/profile</strong></dt>
<dd>Returns a CPU usage profile. The output is in <a class="reference external" href="https://github.com/gperftools/gperftools">pprof</a> format.
The process will be profiled for 10 seconds at a frequency of 100 hz. These
values can be controlled via HTTP request parameters <cite>seconds</cite> and <cite>hz</cite>
respectively.</dd>
</dl>
<div class="highlight-text"><div class="highlight"><pre>$ curl -s localhost:9990/admin/pprof/profile &gt; /tmp/cpu_profiling
$ pprof --text /tmp/cpu_profiling
Using local file /tmp/cpu_profiling.
Using local file /tmp/cpu_profiling.
Total: 83 samples
      17  20.5%  20.5%       24  28.9% com.twitter.finagle.ProxyServiceFactory$class.status
       8   9.6%  30.1%       10  12.0% scala.collection.immutable.HashMap$HashTrieMap.updated0
       5   6.0%  36.1%       70  84.3% scala.collection.Iterator$class.foreach
       5   6.0%  42.2%        5   6.0% scala.runtime.ScalaRunTime$.hash
       4   4.8%  47.0%        4   4.8% com.twitter.finagle.transport.Transport$$anon$2.status
       4   4.8%  51.8%        4   4.8% sun.management.OperatingSystemImpl.getOpenFileDescriptorCount
       3   3.6%  55.4%        9  10.8% com.twitter.finagle.Filter$$anon$2.status
       ...
</pre></div>
</div>
<dl class="docutils">
<dt><strong>/admin/pprof/heap</strong></dt>
<dd>Returns a heap profile computed by the <a class="reference external" href="https://github.com/mariusae/heapster">heapster agent</a>.  The output is in
<a class="reference external" href="https://github.com/gperftools/gperftools">pprof</a> format.</dd>
</dl>
<div class="highlight-text"><div class="highlight"><pre>$ java -agentlib:heapster -jar target/myserver-1.0.0-SNAPSHOT.jar
$ pprof /tmp/heapster_profile
Welcome to pprof!  For help, type &#39;help&#39;.
(pprof) top
Total: 2001520 samples
 2000024  99.9%  99.9%  2000048  99.9% LTest;main
    1056   0.1% 100.0%     1056   0.1% Ljava/lang/Object;
     296   0.0% 100.0%      296   0.0% Ljava/lang/String;toCharArray
     104   0.0% 100.0%      136   0.0% Ljava/lang/Shutdown;
</pre></div>
</div>
<dl class="docutils">
<dt><strong>/admin/metrics.json</strong></dt>
<dd>Export a snapshot of the current statistics of the program. You can
use the StatsReceiver in your application for add new
counters/gauges/histograms, simply use the <cite>statsReceiver</cite> variable
provided by TwitterServer.</dd>
</dl>
<p>See the <a class="reference internal" href="#metrics-label"><em>metrics</em></a> section for more information.</p>
<dl class="docutils">
<dt><strong>/admin/metrics</strong></dt>
<dd>Watch specific stats and extract them via http queries.</dd>
</dl>
<div class="highlight-text"><div class="highlight"><pre>$ curl &quot;localhost:9990/admin/metrics?m=requests_counter&quot;
[
  {
    &quot;name&quot; : &quot;requests_counter&quot;,
    &quot;delta&quot; : 3.0,
    &quot;value&quot; : 10.0
  }
]
</pre></div>
</div>
<dl class="docutils">
<dt><strong>/admin/server_info</strong></dt>
<dd>Return build informations about this server</dd>
</dl>
<div class="highlight-text"><div class="highlight"><pre>{
  &quot;name&quot; : &quot;myserver&quot;,
  &quot;version&quot; : &quot;1.0.0-SNAPSHOT&quot;,
  &quot;build&quot; : &quot;20130221-105425&quot;,
  &quot;build_revision&quot; : &quot;694299d640d337c58fadf668e44322b17fd0562e&quot;,
  &quot;build_branch_name&quot; : &quot;refs/heads/twitter-server!doc&quot;,
  &quot;build_last_few_commits&quot; : [
    &quot;694299d (HEAD, origin/twitter-server!doc, twitter-server!doc) Merge branch &#39;master&#39; into twitter-server!doc&quot;,
    &quot;ba1c062 Fix test for sbt + Jeff&#39;s comments&quot;,
  ],
  &quot;start_time&quot; : &quot;Thu Feb 21 13:43:32 PST 2013&quot;,
  &quot;uptime&quot; : 22458
}
</pre></div>
</div>
<dl class="docutils">
<dt><strong>/admin/contention</strong></dt>
<dd>Show call stack of blocked and waiting threads.</dd>
</dl>
<div class="highlight-text"><div class="highlight"><pre>$ curl localhost:9990/admin/contention
Blocked:
&quot;util-jvm-timer-1&quot; Id=11 TIMED_WAITING on java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject@33aac3c
  at sun.misc.Unsafe.park(Native Method)
  -  waiting on java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject@33aac3c
  at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:226)
  at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:2082)
  at java.util.concurrent.ScheduledThreadPoolExecutor$DelayedWorkQueue.take(ScheduledThreadPoolExecutor.java:1090)
  at java.util.concurrent.ScheduledThreadPoolExecutor$DelayedWorkQueue.take(ScheduledThreadPoolExecutor.java:807)
  at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1043)
  at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1103)
  at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)
  ...
</pre></div>
</div>
<dl class="docutils">
<dt><strong>/admin/clients</strong></dt>
<dd>Surface client information exposed by Finagle. Per-client configuration parameters and
values for each module are available at /admin/clients/&lt;client name&gt;.</dd>
<dt><strong>/admin/servers</strong></dt>
<dd>Surface server information exposed by Finagle. Per-server configuration parameters and
values for each module are available at /admin/clients/&lt;client name&gt;.</dd>
<dt><strong>/admin/registry.json</strong></dt>
<dd>Displays how the service is currently configured across a variety of dimensions
including the client stack, server stack, flags, service loader values, and more.</dd>
<dt><strong>/admin/lint</strong></dt>
<dd>Runs and displays the results for all registered linters to check for various service issues.</dd>
<dt><strong>/admin/shutdown</strong></dt>
<dd>Stop the process gracefully.</dd>
<dt><strong>/admin/tracing</strong></dt>
<dd>Enable (/admin/tracing?enable=true) or disable tracing (/admin/tracing?disable=true)</dd>
</dl>
<p>See <a class="reference external" href="https://github.com/openzipkin/zipkin">zipkin</a> documentation for more info.</p>
<dl class="docutils">
<dt><strong>/admin/threads</strong></dt>
<dd>Dumps the call stacks of all the threads (JSON output).</dd>
</dl>
<div class="highlight-text"><div class="highlight"><pre>{
  &quot;threads&quot; : {
    &quot;12&quot; : {
      &quot;priority&quot; : 5,
      &quot;state&quot; : &quot;TIMED_WAITING&quot;,
      &quot;daemon&quot; : true,
      &quot;thread&quot; : &quot;util-jvm-timer-1&quot;,
      &quot;stack&quot; : [
        &quot;sun.misc.Unsafe.park(Native Method)&quot;,
        &quot;java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:226)&quot;,
        &quot;java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:2082)&quot;,
        &quot;java.util.concurrent.ScheduledThreadPoolExecutor$DelayedWorkQueue.take(ScheduledThreadPoolExecutor.java:1090)&quot;,
        &quot;java.util.concurrent.ScheduledThreadPoolExecutor$DelayedWorkQueue.take(ScheduledThreadPoolExecutor.java:807)&quot;,
        &quot;java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1043)&quot;,
        &quot;java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1103)&quot;,
        &quot;java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)&quot;,
        &quot;java.lang.Thread.run(Thread.java:722)&quot;
      ]
    },
    ...
  }
}
</pre></div>
</div>
<dl class="docutils">
<dt><strong>/admin/ping</strong></dt>
<dd>Return pong (used for monitoring)</dd>
<dt><strong>/admin/logging</strong></dt>
<dd>Display the set of loggers and their current log level. The level of
each logger can also be modified on-the-fly.</dd>
</dl>
<div class="highlight-text"><div class="highlight"><pre>root                              ALL CRITICAL DEBUG ERROR FATAL INFO OFF TRACE WARNING
com.twitter.ostrich.stats.Metric  ALL CRITICAL DEBUG ERROR FATAL INFO OFF TRACE WARNING
com.twitter.ostrich.stats.Stats$  ALL CRITICAL DEBUG ERROR FATAL INFO OFF TRACE WARNING
</pre></div>
</div>
</div>
<div class="section" id="lifecycle-management">
<h2>Lifecycle Management<a class="headerlink" href="#lifecycle-management" title="Permalink to this headline">¶</a></h2>
<p>TwitterServer exposes endpoints to manage server lifecycle that are compatible with
<a class="reference external" href="http://mesos.apache.org/">Mesos&#8217;s</a> job manager:</p>
<dl class="docutils">
<dt><strong>/abortabortabort</strong></dt>
<dd>Abort the process.</dd>
<dt><strong>/health</strong></dt>
<dd>By default, respond with content-body &#8220;OK&#8221;. This endpoint can be managed manually by mixing in
the Lifecycle.Warmup trait with your server.</dd>
<dt><strong>/quitquitquit</strong></dt>
<dd>Quit the process.</dd>
</dl>
<p>These entries are the default, but if you need you can add your own handler to this HTTP server:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="nc">HttpMuxer</span><span class="o">.</span><span class="n">addHandler</span><span class="o">(</span><span class="s">&quot;/echo&quot;</span><span class="o">,</span> <span class="n">service</span><span class="o">)</span>
<span class="nc">HttpMuxer</span><span class="o">.</span><span class="n">addHandler</span><span class="o">(</span><span class="s">&quot;/echo/&quot;</span><span class="o">,</span> <span class="n">service</span><span class="o">)</span>
</pre></div>
</div>
</div>
<div class="section" id="extension">
<h2>Extension<a class="headerlink" href="#extension" title="Permalink to this headline">¶</a></h2>
<p>TwitterServer can be extended modularly by mixing in more traits. If
you want to alter the behavior of a trait that is already mixed into
<cite>TwitterServer</cite>, you can override methods that you want to have
different behavior and then mix it in again. For example, in the
<a class="reference external" href="https://github.com/twitter/util/blob/master/util-logging/src/main/scala/com/twitter/logging/App.scala">Logging</a>
trait, you can override loggers to change where you send logs.</p>
<p>If you want finer grained control over your server, you can remix
traits however you like in the same way that the <a class="reference external" href="https://github.com/twitter/twitter-server/blob/master/src/main/scala/com/twitter/server/TwitterServer.scala">TwitterServer</a>
trait is built.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper"><a href="index.html"><h3>TwitterServer</h3></a>
<p>
  TwitterServer is a library defining a template from which servers at Twitter are built.
</p>

<h3>Useful Links</h3>
<ul>
  <li><a href="http://github.com/twitter/twitter-server">TwitterServer on GitHub</a></li>
  <li><a href="http://github.com/twitter/twitter-server/issues">Issue Tracker</a></li>
</ul>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Features</a><ul>
<li><a class="reference internal" href="#flags">Flags</a></li>
<li><a class="reference internal" href="#logging">Logging</a></li>
<li><a class="reference internal" href="#metrics">Metrics</a><ul>
<li><a class="reference internal" href="#filtering-stats-out">Filtering stats out</a></li>
<li><a class="reference internal" href="#pretty-output">Pretty output</a></li>
</ul>
</li>
<li><a class="reference internal" href="#http-admin-interface">HTTP Admin interface</a></li>
<li><a class="reference internal" href="#lifecycle-management">Lifecycle Management</a></li>
<li><a class="reference internal" href="#extension">Extension</a></li>
</ul>
</li>
</ul>
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">TwitterServer</a></li>
      <li>Next: <a href="Java.html" title="next chapter">Using TwitterServer from Java</a></li>
  </ul></li>
</ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Search the contents of this site.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="footer">
    &copy; Copyright 2015 Twitter, Inc.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div>
  
  </body>
</html>